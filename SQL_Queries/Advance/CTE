WITH customer_lifetime AS (
    SELECT
        customer_id,
        SUM(sales_amount) AS lifetime_sales,
        SUM(profit) AS lifetime_profit
    FROM sales
    GROUP BY customer_id
)
SELECT
    c.customer_name,
    cl.lifetime_sales,
    cl.lifetime_profit
FROM customer_lifetime cl
JOIN customer c
ON cl.customer_id = c.customer_id
ORDER BY cl.lifetime_profit DESC;
